{
  "rules": {
    "users": {
      ".read": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'",
      "$uid": {
        ".read": "auth != null && auth.uid == $uid",
        ".write": "auth != null && auth.uid == $uid"
      }
    },
    "devices": {
      ".read": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'",
      "$deviceId": {
        ".write": "auth != null && root.child('users').child(auth.uid).child('deviceId').val() == $deviceId"
      }
    },
    "alerts": {
      // Admins can read everything
      ".read": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'",
      "$deviceId": {
        // A driver can read their own device's alerts
        ".read": "auth != null && root.child('users').child(auth.uid).child('deviceId').val() == $deviceId",
        // Device writes its own alerts
        ".write": "auth != null && root.child('users').child(auth.uid).child('deviceId').val() == $deviceId"
      }
    },
    "history": {
      // Admins can read everything
      ".read": "auth != null && root.child('users').child(auth.uid).child('role').val() == 'admin'",
      "$deviceId": {
         // A driver can read their own device's history
        ".read": "auth != null && root.child('users').child(auth.uid).child('deviceId').val() == $deviceId",
        // Device writes its own history
        ".write": "auth != null && root.child('users').child(auth.uid).child('deviceId').val() == $deviceId"
      }
    }
  }
}
